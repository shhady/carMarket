const carMarket = {
  sellers: [
    {
      agencyName: "Best Deal",
      cash: 1245000,
      credit: 200000,
      agencyId: "Plyq5M5AZ",

      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "3",
              year: 2015,
              price: 137000,
              carNumber: "AZJZ4",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "X6",
              year: 2020,
              price: 966500,
              carNumber: "S6DL1",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2020,
              price: 336300,
              carNumber: "6rvXw",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Hilux",
              year: 2005,
              price: 35005,
              carNumber: "MWXBG",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Corolla",
              year: 2020,
              price: 111900,
              carNumber: "hCzl-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Focus",
              year: 2020,
              price: 98200,
              carNumber: "kN3HP",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Focus",
              year: 2005,
              price: 6502,
              carNumber: "LJTCs",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Romeo Julia",
              year: 2020,
              price: 275406,
              carNumber: "2kjy7",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Romeo Stelvio",
              year: 2019,
              price: 215403,
              carNumber: "7A5b-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Traverse",
              year: 2020,
              price: 201102,
              carNumber: "QwBOT",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Impala",
              year: 2019,
              price: 165041,
              carNumber: "2v4jt",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Malibu",
              year: 2017,
              price: 75405,
              carNumber: "O4_Jv",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
      ],
    },
    {
      agencyName: "CarMax",
      cash: 968541,
      credit: 500000,
      agencyId: "26_IPfHU1",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X5",
              year: 2015,
              price: 218000,
              carNumber: "4Ixb0",
              ownerId: "26_IPfHU1",
            },
            {
              name: "X6",
              year: 2014,
              price: 97100,
              carNumber: "kAnv-",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Z4",
              year: 2019,
              price: 296900,
              carNumber: "ISMdU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "3",
              year: 2010,
              price: 75100,
              carNumber: "9DJPw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2005,
              price: 80540,
              carNumber: "Kt-pW",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Corolla",
              year: 2019,
              price: 109100,
              carNumber: "YiYdI",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Hilux",
              year: 2019,
              price: 204000,
              carNumber: "DRmNw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "F250",
              year: 2020,
              price: 198500,
              carNumber: "g4Wfp",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Explorer",
              year: 2020,
              price: 265200,
              carNumber: "iNT8Q",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Spider",
              year: 2011,
              price: 75405,
              carNumber: "6t7QU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "166",
              year: 2002,
              price: 12400,
              carNumber: "XMqpn",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2016,
              price: 65042,
              carNumber: "vbeAo",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Savannah",
              year: 2016,
              price: 76505,
              carNumber: "WelWa",
              ownerId: "26_IPfHU1",
            },
          ],
        },
      ],
    },
    {
      agencyName: "The Auto World",
      cash: 687450,
      credit: 200000,
      agencyId: "gNHjNFL12",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X6",
              year: 2018,
              price: 548100,
              carNumber: "EMW_7",
              ownerId: "gNHjNFL12",
            },
            {
              name: "3",
              year: 2017,
              price: 178000,
              carNumber: "XlnB4",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2017,
              price: 101542,
              carNumber: "-RQgN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Highlander",
              year: 2017,
              price: 202540,
              carNumber: "AZJZ4",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 1996,
              price: 5420,
              carNumber: "kHE8f",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 2012,
              price: 40570,
              carNumber: "p2qEi",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Explorer",
              year: 2014,
              price: 127502,
              carNumber: "Ty1zN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "F350",
              year: 2012,
              price: 54250,
              carNumber: "z03H2",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Savannah",
              year: 2010,
              price: 36504,
              carNumber: "RXFZe",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Malibu",
              year: 2009,
              price: 19585,
              carNumber: "K5IsM",
              ownerId: "gNHjNFL12",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Car Werks",
      cash: 302502,
      credit: 150000,
      agencyId: "9KeaYbRLP",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "8",
              year: 2020,
              price: 942500,
              carNumber: "4IUMz",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X6",
              year: 2010,
              price: 129000,
              carNumber: "Vw0fV",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X3",
              year: 2019,
              price: 358100,
              carNumber: "ufN54",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2020,
              price: 389100,
              carNumber: "F127X",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2002,
              price: 18400,
              carNumber: "ueZUp",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2011,
              price: 38520,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Land Cruiser",
              year: 2019,
              price: 290040,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2020,
              price: 215700,
              carNumber: "xig8N",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2015,
              price: 178506,
              carNumber: "ghTiQ",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Corolla",
              year: 2002,
              price: 8504,
              carNumber: "Mvw8T",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2005,
              price: 9320,
              carNumber: "BZpkt",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Malibu",
              year: 2002,
              price: 4502,
              carNumber: "KqKV_",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Carsova",
      cash: 72450,
      credit: 50000,
      agencyId: "oqQmsZoUo",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "7",
              year: 1999,
              price: 24700,
              carNumber: "sZrjp",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "3",
              year: 2008,
              price: 54000,
              carNumber: "da88K",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2019,
              price: 124050,
              carNumber: "ZfbqH",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "Hilux",
              year: 1996,
              price: 11540,
              carNumber: "AZJZ4",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
      ],
    },
  ],
  customers: [
    {
      name: "Lilah Goulding",
      id: "BGzHhjnE8",
      cars: [
        {
          name: "Corolla",
          year: 2013,
          price: 40570,
          carNumber: "16da1",
          ownerId: "BGzHhjnE8",
        },
      ],
      cash: 35000,
    },
    {
      name: "Ravi Murillo",
      id: "2RprZ1dbL",
      cars: [
        {
          name: "M5",
          year: 2019,
          price: 578054,
          carNumber: "WIh0U",
          ownerId: "2RprZ1dbL",
        },
        {
          name: "Spider",
          year: 2012,
          price: 81520,
          carNumber: "RLS4q",
          ownerId: "2RprZ1dbL",
        },
      ],
      cash: 278542,
    },
    {
      name: "Aleksander Carr",
      id: "pAuFtn_WA",
      cars: [
        {
          name: "Highlander",
          year: 2018,
          price: 214503,
          carNumber: "2WU_y",
          ownerId: "pAuFtn_WA",
        },
      ],
      cash: 125402,
    },
    {
      name: "Lana Edge",
      id: "cnTobUDy6",
      cars: [
        {
          name: "F250",
          year: 2020,
          price: 198500,
          carNumber: "Xxcy_",
          ownerId: "cnTobUDy6",
        },
        {
          name: "Hilux",
          year: 2005,
          price: 35005,
          carNumber: "VSCUj",
          ownerId: "cnTobUDy6",
        },
      ],
      cash: 7000,
    },
    {
      name: "Nikita Philip",
      id: "5x2tMcX4R",
      cars: [
        {
          name: "Impala",
          year: 2016,
          price: 65042,
          carNumber: "LKInp",
          ownerId: "5x2tMcX4R",
        },
      ],
      cash: 40541,
    },
    {
      name: "Bob Steel",
      id: "Wm6BkA1F0",
      cars: [],
      cash: 15732,
    },
    {
      name: "Will Reyes",
      id: "FQvNsEwLZ",
      cars: [
        { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
        {
          name: "Land Cruiser",
          year: 2020,
          price: 336300,
          carNumber: "vaJvd",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Romeo Julia",
          year: 2020,
          price: 275406,
          carNumber: "qLoYR",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Explorer",
          year: 2020,
          price: 265200,
          carNumber: "tlGRq",
          ownerId: "FQvNsEwLZ",
        },
      ],
      cash: 1547242,
    },
  ],
  taxesAuthority: {
    totalTaxesPaid: 0,
    sumOfAllTransactions: 0,
    numberOfTransactions: 0,
  },
};

//! agency's func's
//todo getters

//* getAgencyByName
//? @param {string} - name
//? @return {Object} - agency object

const getAgencyByName = (name) => {
  return carMarket.sellers.find((x) => (x.agencyName = name));
};
// console.log(getAgencyByName("Best Deal"));

//* getAgencyIdByName
//? @param {String} - name
//? @return {String} - agencyId

carMarket.getAgencyIdByName = function (name) {
  const agency = this.sellers.find((agencyObject) => {
    return name === agencyObject.agencyName;
  });
  if (agency !== undefined) {
    return agency.agencyId;
  }
  return undefined;
};
// console.log(carMarket.getAgencyIdByName("Best Deal"));

//* getAllAgenciesName
//? @param {}
//? @return {string[]} - agenciesNameArr - Array of all agencies name

carMarket.getAllAgenciesName = function () {
  agenciesNameArr = [];
  // return this.sellers.filter((AllAgencies) => AllAgencies.agencyName === 'name');
  agenciesNameArr.push(
    this.sellers.map((AllAgencies) => AllAgencies.agencyName)
  );
  return agenciesNameArr;
};

// console.log(carMarket.getAllAgenciesName());

//* getAllCarToBuy
//? @param {}
//? @return {object[]} - allCarsToBuy - arrays of all cars objects

carMarket.getAllCarToBuy = function () {
  let carsArr = [];
  this.sellers.forEach((agency) => {
    return agency.cars.forEach((car) =>
      car.models.forEach((model) =>
        carsArr.push({ brand: car.brand, ...model })
      )
    );
  });
  return carsArr;
};
// console.log(carMarket.getAllCarToBuy());

//* getAllCarToBuyByAgencyId
//? @param {string} - id of agency
//? @return {object[]} - carsArray - arrays of all models objects of specific agency

carMarket.getAllCarToBuyByAgencyId = function (agencyId) {
  let cars = [];
  let agency = this.sellers.find((agency) => agency.agencyId == agencyId);

  agency.cars.forEach((car) =>
    car.models.forEach((model) => cars.push({ brand: car.brand, ...model }))
  );
  return cars;
};
console.log("_____________________________________");
// console.log(carMarket.getAllCarToBuyByAgencyId("oqQmsZoUo"));

//* getAllBrandsToBuyAgencyId
//? @param {string} - agencyId -  id of agency
// ? @return {string[]} - arrOfBrands - arrays of all brands name in specific agency
carMarket.getAllBrandsToBuyAgencyId = function (agencyId) {
  let cars = [];
  let agency = this.sellers.find((agency) => agency.agencyId == agencyId);

  agency.cars.forEach((car) => cars.push(car.brand));
  return cars;
};
// console.log(carMarket.getAllBrandsToBuyAgencyId("oqQmsZoUo"));

//! customer func's
//todo getters
//* getCustomerByName
//? @param {string} - name
//? @return {Object} - customer
carMarket.getCustomerByName = (name) => {
  return carMarket.customers.find((x) => (x.name = name));
};
// console.log(carMarket.getCustomerByName("Lilah Goulding"));

//* getCustomerIdByName
//? @param {name}
//? @return {String} - customerId - The customer id

carMarket.getCustomerIdByName = function (name) {
  const customer = this.customers.find((customerObject) => {
    return name === customerObject.name;
  });
  if (customer) {
    return customer.id;
  }
  return undefined;
};

// console.log(carMarket.getCustomerIdByName("Lilah Goulding"));

//* getAllCustomersNames
//? @param {}
//? @return {string[]} - customersNameArr -  Array of all customers name

carMarket.getAllCustomersNames = function (name) {
  let customersNameArr = [];
  customersNameArr.push(this.customers.map((allNames) => allNames.name));
  return customersNameArr;
};

// console.log(carMarket.getAllCustomersNames());

//* getAllCustomerCars
//? @param {id} - costumerId - costumer id
//? @return {object[]} - customerCarsArr -  Array of all customer cars object

carMarket.getAllCustomerCars = function (id) {
  let cars = [];
  let customer = this.customers.find((customer) => customer.id == id);

  customer.cars.forEach((car) => cars.push(car));
  return cars;
};

// console.log(carMarket.getAllCustomerCars("5x2tMcX4R"));

//* getCustomerCash
//? @param {id} - costumerId - costumer id
//? @return {number} - CustomerCash

carMarket.getCustomerCash = function (id) {
  const customer = this.customers.find((x) => x.id === id);
  return customer.cash;
};
// console.log(carMarket.getCustomerCash("Wm6BkA1F0"));
//-------------------------------------------------

//*  1) setPropertyBrandToAllCars
//? set all cars model object the current brand
//? @param {}
//? @return {}

carMarket.setPropertyBrandToAllCars = function () {
  this.sellers.forEach((agency) => {
    agency.cars.forEach((car) =>
      car.models.forEach((model) => (model.brand = car.brand))
    );
  });
};
carMarket.setPropertyBrandToAllCars();
// console.log(carMarket.sellers[0].cars[1].models);

//todo Agency setters

//* setNewCarToAgency
//? @param {string} - id of agency
//? @param {object} - carObject
//? @return {}
carMarket.setNewCarToAgency = function (agencyId, carObject) {
  this.sellers
    .find((agency) => agency.agencyId === agencyId)
    .cars.push(carObject);
};

//* deleteCarFromAgency
//? @param {string} - id of agency
//? @param {string} -  Car id
// ? @return {}

carMarket.deleteCarFromAgency = function (marketObj, agencyId, carId) {
  const agencyObj = marketObj.sellers.find(
    (agency) => agency.agencyId === agencyId
  );

  for (let i = 0; i < agencyObj.cars.length; i++) {
    let carToDelete = agencyObj.cars[i].models.findIndex(
      (model) => model.carNumber === carId
    );
    if (carToDelete !== -1) {
      agencyObj.cars[i].models.splice(carToDelete, 1);
      break;
    }
  }
};

// carMarket.deleteCarFromAgency(carMarket, "Plyq5M5AZ", "MWXBG");
// console.log(carMarket.sellers[0].cars[1].models);

//* decrementOrIncrementCashOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCashOfAgency = function (
  marketObj,
  agencyId,
  amount
) {
  return (marketObj.sellers.find(
    (agency) => agency.agencyId === agencyId
  ).cash += amount);
};

// console.log(
// carMarket.decrementOrIncrementCashOfAgency(carMarket, "Plyq5M5AZ", -1000000));

//* decrementOrIncrementCreditOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCreditOfAgency = function (
  marketObj,
  agencyId,
  amount
) {
  return (marketObj.sellers.find(
    (agency) => agency.agencyId === agencyId
  ).credit += amount);
};

// console.log(carMarket.decrementOrIncrementCreditOfAgency(carMarket, "Plyq5M5AZ", 1000000));

//* setAmountOfCarsToBuyToAllAgency's
//? set a new property amountOfCars to all agency's, that represent the amount of cars available in the agency.
//? @param {}
// ? @return {objects[]} - sellers - array of all agency's

carMarket.setAmountOfCarsToBuyToAllAgency = function (carMarket) {
  carMarket.setAmountOfCarsToBuyToAllAgency = function (carMarket) {
    carMarket.sellers.forEach((agency) => {
      let counter = 0;
      agency.cars.forEach((car) => (counter += car.models.length));
      agency.amountOfCars = counter;
    });
    return carMarket.sellers;
  };

  return carMarket.sellers;
};

// console.log(carMarket.setAmountOfCarsToBuyToAllAgency(carMarket));

//todo setters
//* setCarToCostumer
//? @param {string} - costumerId
//? @param {object} - carObject
//? @return {object[]} - allCarsOfCostumer

carMarket.setCarToCostumer = function (marketObj, customerId, carObj) {
  const customerObj = marketObj.customers.find(
    (customer) => customer.id === customerId
  );
  customerObj.cars.push(carObj);

  return customerObj.cars;
};

const carObj = {
  name: "fiat",
  year: 19910,
  price: 1244,
  carNumber: "sghssh",
  ownerId: "noID",
};

// console.log(carMarket.setCarToCostumer(carMarket, "FQvNsEwLZ", carObj));

//* deleteCarOfCostumer
//? @param {string} - costumerId
//? @param {string} - carId
//? @return {object[]} - allCarsOfCostumer
carMarket.deleteCarOfCostumer = function (marketObj, customerId, carId) {
  const customerObj = marketObj.customers.find(
    (customer) => customer.id === customerId
  );
  const carToDelete = customerObj.cars.findIndex(
    (car) => car.carNumber === carId
  );
  if (carToDelete !== -1) {
    customerObj.cars.splice(carToDelete, 1);
  }
  return customerObj.cars;
};

// console.log(carMarket.deleteCarOfCostumer(carMarket, "FQvNsEwLZ", "vaJvd"));

//* decrementOrIncrementCashOfCostumer
//? @param {string} - costumerId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - costumerCash

carMarket.decrementOrIncrementCashOfCostumer = function (
  marketObj,
  customerId,
  amount
) {
  return (marketObj.customers.find(
    (customer) => customerId === customer.id
  ).cash += amount);
};

// console.log( carMarket.decrementOrIncrementCashOfCostumer(carMarket, "FQvNsEwLZ", -1547242));

//! -------------------------------------------------------
//* 2) sortAndFilterByYearOfProduction
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by year of production.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByYearOfProduction = function (
  carArray,
  fromYear,
  toYear,
  isAscendingOrder
) {
  const modelsArray = [];
  carArray.forEach((car) => {
    car.models.forEach((model) => {
      if (fromYear <= model.year && model.year <= toYear) {
        modelsArray.push(model);
      }
    });
  });
  if (isAscendingOrder) {
    modelsArray.sort((a, b) => a.year - b.year);
  } else {
    modelsArray.sort((a, b) => b.year - a.year);
  }
  return modelsArray;
};

// console.log(
//   carMarket.sortAndFilterByYearOfProduction(
//     carMarket.sellers[0].cars,
//     2005,
//     2015,
//     true
//   )
// );

//* 3) sortAndFilterByPrice
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by price of the cars.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByPrice = function (
  carArray,
  fromPrice,
  toPrice,
  isAscendingOrder
) {
  const modelsArray = [];
  carArray.forEach((car) => {
    car.models.forEach((model) => {
      if (fromPrice <= model.price && model.price <= toPrice) {
        modelsArray.push(model);
      }
    });
  });
  if (isAscendingOrder) {
    modelsArray.sort((a, b) => a.price - b.price);
  } else {
    modelsArray.sort((a, b) => b.price - a.price);
  }
  return modelsArray;
};

// console.log(
//   carMarket.sortAndFilterByPrice(
//     carMarket.sellers[0].cars,
//     50000,
//     200000,
//     false
//   )
// );

//* 4 ) searchCar
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   optional @param {string} - brand - Look only for cars of this brand

carMarket.searchCar = function (
  carArray,
  fromYear,
  toYear,
  fromPrice,
  toPrice,
  brand
) {
  const modelsArray = [];
  carArray.forEach((car) => {
    car.models.forEach((model) => {
      if (
        fromYear <= model.year &&
        model.year <= toYear &&
        fromPrice <= model.price &&
        model.price <= toPrice
      ) {
        if (brand) {
          if (brand === car.brand) {
            modelsArray.push(model);
          }
        } else {
          modelsArray.push(model);
        }
      }
    });
  });

  return modelsArray;
};

// console.log(
//   carMarket.searchCar(
//     carMarket.sellers[0].cars,
//     2005,
//     2015,
//     5000,
//     50000,
//     "toyota"
//   )
// );

//* 5 ) sellCar
//?   Sell ​​a car to a specific customer
//?   @param {string} - agencyId
//?   @param {string} - customerId
//?   @param {string} - carModel
//?   @return {object} - The object of the car purchased by the customer or an explanation message
// *     - 5a. Subtract the vehicle amount + 17% (tax) from the customer's cash.
// *     - 5b. Add the vehicle value to the car agency cash.
// *     - 5c. Change the car owner's id to the customer's id.
// *     - 5d. Remove the car from the array of the agency's car models.
// *     - 5e. Add the car to the client cars array.
// *
// *     Taxes Authority:
// *     - 5f. Pay 17 percent of the vehicle value to the tax authority. (add the amount to totalTaxesPaid)
// *     - 5g. Increase the number of transactions made in one (numberOfTransactions)
// *     - 5h. Add the vehicle amount + tax to sumOfAllTransactions
// !     - Check that there is the requested vehicle at the agency in not return 'The vehicle does not exist at the agency'
// !     - Check that the customer has enough money to purchase the vehicle, if not return 'The customer does not have enough money'

//!      - Try to divide the tasks into several functions and try to maintain a readable language.

carMarket.sellCar = function (marketObj, agencyId, customerId, carModel) {
  const arr = [];
  const agencyObj = marketObj.sellers.find((agency) => {
    return agency.agencyId === agencyId;
  });
  const customerObj = marketObj.customers.find((customer) => {
    return customer.id === customerId;
  });
  agencyObj.cars.forEach((car) => {
    const carOb = car.models.find((model) => {
      return model.name === carModel;
    });
    if (carOb) {
      arr.push(carOb);
    }
  });
  const carObj = arr[0];
  if (!carObj) {
    return "The vehicle does not exist at the agency";
  }

  if (carObj.price * 1.17 > customerObj.cash) {
    return `Sorry! not enough money to purchase the car. Customer has ${
      customerObj.cash
    }, need at least: ${carObj.price * 1.17}`;
  } else {
    marketObj.deleteCarFromAgency(marketObj, agencyId, carObj.carNumber);
    customerObj.cash -= carObj.price * 1.17;
    agencyObj.cash += carObj.price;
    marketObj.taxesAuthority.totalTaxesPaid += carObj.price * 0.17;
    marketObj.taxesAuthority.sumOfAllTransactions += carObj.price * 1.17;
    marketObj.taxesAuthority.numberOfTransactions += 1;
  }
  //!----------------------------------------------------------------
  customerObj.cars.push(carObj);
  customerObj.cars[customerObj.cars.length - 1].ownerId = customerId;
  return customerObj.cars[customerObj.cars.length - 1];
};
console.log(carMarket.sellCar(carMarket, "Plyq5M5AZ", "FQvNsEwLZ", "X6"));
